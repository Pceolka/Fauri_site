{% extends 'base.html' %}
{% load static %}
{% block content %}

<body class="animsition">

<!-- Calendar -->
<section class="bg0">
    <div class="container">
        <div class="calendar" style="border: 2px solid black;">
            <div class="calendar__picture" id="calendar-image">
                <h2 id="calendar-header">{{ events.header }}</h2>
            </div>

            <div class="calendar__date">
                <div class="calendar__day">Пн</div>
                <div class="calendar__day">Вт</div>
                <div class="calendar__day">Ср</div>
                <div class="calendar__day">Чт</div>
                <div class="calendar__day">Пн</div>
                <div class="calendar__day">Сб</div>
                <div class="calendar__day">Вс</div>
            </div>
            {{ calendar|safe }}

        </div>
    </div>
</section>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
<script>
    function updateCalendar(eventId) {
        // Получаем информацию о событии с помощью AJAX-запроса
        // и обновляем верхнюю часть календаря
        $.ajax({
            url: '/get-event-info/',
            data: {event_id: eventId},
            dataType: 'json',
            success: function (data) {
                $('#calendar-image').css('background-image', 'url("' + data.image_url + '")');
                $('#calendar-header').text(data.header);
            }
        });
    }

    function getClosestEventId() {
        var currentDate = new Date();
        var closestEventId = null;
        var closestEventDateDiff = Infinity;

        {% for event in events %}
            var eventDate = new Date("{{ event.date }}");
            var dateDiff = Math.abs(eventDate - currentDate);

            if (dateDiff < closestEventDateDiff) {
                closestEventDateDiff = dateDiff;
                closestEventId = "{{ event.id }}";
            }
        {% endfor %}

        return closestEventId;
    }

    function bindEventHandlers() {
        $('.calendar__number--current').click(function () {
            var eventId = $(this).data('id');
            updateCalendar(eventId);
        });

        var closestEventId = getClosestEventId();
        updateCalendar(closestEventId);
    }

    bindEventHandlers();
</script>

</body>

{% endblock content %}
